<!doctype html>
<html><head>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<style type='text/css'>
		h1 { color:steelblue; font-size:24px; margin-top:24px; }
		button { margin:0 3px 10px; font-size:12px; }
        body img{max-width:100%}
	</style>
    
</head><body onload="onLoaded()">
	<!--<h1>WebViewJavascriptBridge Demo</h1>-->
    <!--<p>　　2016年3月6日13时50分许，吉林省辽源市龙山区发生一起伤害致死案件，犯罪嫌疑人作案后逃离现场。-->
        <!--经过公安机关不懈努力，犯罪嫌疑人李晓鹏在行凶作案后93小时被赤峰市公安机关抓获归案。-->
    <!--</p>-->
    <!--<p>　　2016年3月7日晚，<img src="1.gif">赤峰市公安部门接到吉林省公安部门的协查通报：2016年3月6日13时50分许，辽源市龙山区发-->
        <!--生一起伤害致死案件。经查，李晓鹏有重大作案嫌疑。犯罪嫌疑人基本情况：李晓鹏，男、汉族、身份证号：2204021-->
        <!--97908140810，吉林省人，身高175cm左右，吉林口音，逃跑时身穿绿色军大衣、浅色牛仔裤、灰色鞋。</p><p>　　赤-->
        <!--峰市公安局接到内蒙古公安厅关于吉林省“3.06”命案协查指令后，市公安局党委高度重视，全市启动80个治安卡口-->
        <!--，由特警、刑警、交警联合执行一级武装堵卡勤务，重点部署赤峰中心城区11个出城卡口、火车站、汽车站、飞机-->
        <!--场执行一级加强勤务，同时开展全市治安大清查行动，形成全市严查严控态势，确保犯罪嫌疑人不逃出赤峰。并通-->
        <!--过微博、微信和中国青年网交通广播等媒体渠道向社会发布协查通报，广泛发动社会力量提供嫌疑人线索。</p><p>　-->
        <!--　3月9日19点21分，赤峰公安微信公众号发出《关于协查吉林省辽源市命案嫌疑人李晓鹏的通报》</p><p>　　<b>-->
        <!--犯罪嫌疑人7日现身赤峰</b></p><p>　　2016年3月7日凌晨1时20分许，在赤峰市红山区长青街西段蒙小对过、盐-->
        <!--业公司附近打乘一辆出租车向西离去，打车时身穿绿色军用棉大衣，手拎黑色塑料袋。望广大群众积极提供线索，提供-->
        <!--案件重大线索或直接破案者，奖励人民币5万元，并为其严格保密。-->
    <!--</p><img src = 'http://img1.cache.netease.com/catchpic/D/D6/D67338B638541C548704D34CFBA6C201.jpg'>-->
    <!--<p>　　3月10日上午，市公安局合成作战中心通过技术研判，确定嫌疑人藏匿在红山区头道街附近，市局围堵查缉指挥-->
        <!--部指令红山分局立即对红山区头道街进行全面清查。上午10时40分，红山分局清查组在一出租房内发现嫌疑人所-->
        <!--穿的绿色棉大衣，随后在附近另一出租房内将嫌疑人李晓鹏抓获。</p><img src = 'http://img1.cache.netease.com/catchpic/5/5B/5B8A069287F3D51495C8F5D11857DCC4.jpg'><p>-->
        <!--<b>事件回顾：</b></p><p>　　3月6日下午，吉林省辽源市政协副主席孙庆安在自家小区电梯内遇刺身亡-->
        <!--。孙庆安的脖子和胸口多处被刀捅伤。事发时，孙庆安和妻子同在电梯内。凶手刺杀孙以后，便快速逃离了现场-->
        <!--。</p><p>　　综合多个信源消息，犯罪嫌疑人为一名38岁的中年男子，是辽源市经济开发区一名拆迁户，此前-->
        <!--在当地某政府部门做司机，案发前早已辞职。</p><p>（原标题：杀害吉林辽源政协副主席嫌犯在内蒙古落网）</p>-->
    <p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';font-size:14px;line-height:1.5;">昵称：双儿baby</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;font-size:14px;"></span><span style="font-family:'Microsoft YaHei';font-size:14px;line-height:1.5;">年龄：22岁</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;font-size:14px;">职业：平面模特</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;font-size:14px;">来自：四川</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;font-size:14px;">在盛产美女的四川，双儿的颜值可以算得上一等一了，既然可以靠脸吃饭，那就发挥到极致，年仅22岁的她已经是小有成就的平面模特了。<span style="line-height:2;"></span><br /><img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101453143718.jpg" alt="" /></span></p><p class="MsoNormal">	<span style="background-color:#FFE500;color:#64451D;font-size:18px;font-family:'Microsoft YaHei';line-height:2;">高颜值“女汉子”能量满满活出范儿</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';"><span style="font-size:14px;">汉子风兼备少女心，这位自带光环的姑娘，勇敢而真诚，她一直自立自强自己买花儿戴。在与双儿的聊天中，大妹感受到的是满满的正能量，在“女不强大天不容”的时代语境里，她通过努力将生活过成自己想要的样子，把自己经营成“美好”的代名词。<span style="line-height:2;"></span><br /><img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101452305563.jpg" alt="" /></span><br /></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';font-size:14px;"><span style="line-height:1.5;">模特不仅仅是掌声和闪光灯，摆十几个小时POSE是家常便饭，反季节拍摄需要忍受温度的煎熬，从刚开始的不堪重负以至经常的眼泪含眶到现在</span><span style="line-height:1.5;">只要站到镜头前再苦再累依旧气定神闲，这其中的付出可想而知。“握在手里的，已是过去。下一秒的未知，突破自我。”这是双儿从未变过的工作信条，情理之中她亦是做的很好。</span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;">&nbsp;<img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101444026787.jpg" alt="" /></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';background-color:#FFE500;color:#64451D;font-size:18px;"><span style="line-height:1.5;"></span><span style="line-height:2;">爱旅行<span style="line-height:1.5;"></span>爱美食，为</span><span style="line-height:2;"><span style="line-height:1.5;"></span>工作做最大的让步</span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';"><span style="font-size:14px;line-height:1.5;">私底下的双儿和大多数普通女孩儿一样爱旅游，<span style="font-size:14px;font-family:'Microsoft YaHei';">最喜欢说走就走的旅行，不受束缚很自由。她说让其畅快淋漓的并非是旅途中的绝世美景，而是原本稍显阴霾的心情渐渐褪去，一路走来自己越发轻松明朗的心境。</span></span><span></span></span></p><p class="MsoNormal">	<span style="font-family:Microsoft YaHei;"><span style="font-size:14px;line-height:1.5;"><span style="font-size:14px;font-family:'Microsoft YaHei';">美食对于双儿来说也是不可抗拒的，美食可以放大她的愉悦，但因为工作属性每次只能浅尝辄止，这可能是双儿人生中最大的妥协了。在家的双儿喜欢捣鼓菜谱，各种尝试，她说看到亲人朋友吃到她亲手做的菜是幸</span><span style="line-height:2;font-size:14px;font-family:'Microsoft YaHei';"></span><span style="font-size:14px;font-family:'Microsoft YaHei';">福</span>的</span><span style="line-height:1.5;">。<br /></span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;">&nbsp;</span><img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101441476318.jpg" alt="" /></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';"><span></span><span style="font-size:14px;">然后不得不说的两只小家伙在家里存在感也是杠杠的，可爱的奶茶和呆萌熊熊，它们的陪伴已经是双儿生活里不可或缺的一部分，最喜欢把它们打扮的漂漂亮亮的带出去遛一遛。</span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;">&nbsp;</span><img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101441556668.jpg" alt="" /><span style="background-color:#FFE500;font-family:'Microsoft YaHei';line-height:1.5;"><br /><span style="color:#64451D;font-family:'Microsoft YaHei';font-size:18.18181800842285px;line-height:24.545454025268555px;background-color:#FFE500;"><span style="line-height:2;">理财带来安全感让人更有底气</span><br /></span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';font-size:14px;">双儿的收入相对来说是可观的，在没有理财之前大多都挣多少用多少，从不节制，日子过的可谓是潇洒。后来知道余额宝，她把自己的一点钱存进去日积月累分外惊喜，之后慢慢的她就搜这种平台，最后发现温商贷&nbsp;，给她有异于别的平台比较安全的感觉，所以果断把别的平台的抛出去，温商贷现在是双儿的重仓，她表示每月2000多的利息挺满意，财务状况好</span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';"><span style="font-size:14px;">人也更有底气了。</span></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';line-height:1.5;"><img src="http://bbsstatic.wsloan.com/picfile/KEUpload/image/1603101444191912.jpg" alt="" /><br /></span></p><p class="MsoNormal">	<span style="font-family:'Microsoft YaHei';"><span style="font-size:14px;">最后双</span><span></span><span style="font-size:14px;">儿表达了对温商贷的祝福，同时说出了广大用户的心声不要再降息最好不过了，当然安全是最重要的。</span></span></p>
    <script>
//        <img src = '/Users/chenzhangquan/Library/Developer/CoreSimulator/Devices/F83367E9-FFE9-4BE5-88E2-94D62A9F14A9/data/Containers/Data/Application/FB147889-FCE9-4637-80F1-FB1B3023D594/Library/Caches/default/com.hackemist.SDWebImageCache.default/a7fee2872624ef4827b3c36db9b18036.jpg'>

function setupWebViewJavascriptBridge(callback) {
    if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
    if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
    window.WVJBCallbacks = [callback];
    var WVJBIframe = document.createElement('iframe');
    WVJBIframe.style.display = 'none';
    WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
    document.documentElement.appendChild(WVJBIframe);
    setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
}
    setupWebViewJavascriptBridge(function(bridge) {
                                 
        /* Initialize your app here */
        bridge.registerHandler('JS Echo', function(data, responseCallback) {
        })

        bridge.registerHandler('imagesDownloadComplete', function imagesDownloadComplete(pData) {

            var pOldUrl = pData[0];
            var pNewUrl = pData[1];
            var allImage = document.querySelectorAll("img");


            for(var i = 0 ;i < allImage.length;i++){
                if(allImage[i].getAttribute('esrc') == pOldUrl || allImage[i].getAttribute('esrc') == decodeURIComponent(pOldUrl) ){
                    allImage[i].src = pNewUrl
                }

            }

        })

    })


    
    function onLoaded(){

        
        var allImage = document.querySelectorAll("img");

        allImage = Array.prototype.slice.call(allImage, 0);

        var imageUrlsArray = new Array();

        allImage.forEach(function(image) {
                         
            var src = image.getAttribute("src");
            image.setAttribute("esrc", src);
            var esrc = src;


            if(src.indexOf('http') > -1){
                image.removeAttribute("src")
                image.onclick = function(){onImageClick(esrc)};
                //var esrc = image.getAttribute("esrc");
                var newLength = imageUrlsArray.push(esrc);
            }

         
        });

<!--        bridge.send(imageUrlsArray);-->
        setupWebViewJavascriptBridge(function(bridge) {
                             
            bridge.callHandler('downloadImages', {'images':imageUrlsArray}, function(response) {

            });
        });
    }



function onImageClick(picUrl){

    setupWebViewJavascriptBridge(function(bridge) {

        var allImage = document.querySelectorAll("img[esrc]");

        allImage = Array.prototype.slice.call(allImage, 0);

        var urls = new Array();

        var index = -1;

        var x = 0;

        var y = 0;

        var width = 0;

        var height = 0;

        allImage.forEach(function(image) {

            var imgUrl = image.getAttribute("esrc");

            var newLength = urls.push(imgUrl);

            if(imgUrl == picUrl || imgUrl == decodeURIComponent(picUrl)){

                index = newLength-1;

                x = image.getBoundingClientRect().left;

                y = image.getBoundingClientRect().top;

                x = x + document.documentElement.scrollLeft;

                y = y + document.documentElement.scrollTop;

                width = image.width;

                height = image.height;

                console.log("x:"+x +";y:" + y+";width:"+image.width +";height:"+image.height);

            }

        });

        console.log("检测到点击");

        bridge.callHandler('imageDidClicked', {'index':index,'x':x,'y':y,'width':width,'height':height}, function(response) {

            console.log("JS已经发出imgurl和index，同时收到回调，说明OC已经收到数据");

        });

    });

}




function obj2string(o){
        var r=[];
        if(typeof o=="string"){
            return "\""+o.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+"\"";
                                     }
                                     if(typeof o=="object"){
                                     if(!o.sort){
                                     for(var i in o){
                                     r.push(i+":"+obj2string(o[i]));
                                     }
                                     if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)){
                                     r.push("toString:"+o.toString.toString()); 
                                     } 
                                     r="{"+r.join()+"}"; 
                                     }else{ 
                                     for(var i=0;i<o.length;i++){ 
                                     r.push(obj2string(o[i])) 
                                     } 
                                     r="["+r.join()+"]"; 
                                     } 
                                     return r; 
                                     } 
                                     return o.toString(); 
                                     }



    function testButtonClick() {


        setupWebViewJavascriptBridge(function(bridge) {

            bridge.callHandler('ObjC Echo', {'数据':1}, function(response) {
            });
        });

    }

	</script>
    <button  onclick="testButtonClick();">testbutton</button>
    

</body></html>
